@startuml
!pragma teoz true

/' Hard delete cascade flow for deliverability_test and deliverability_test_logs. '/

actor User as user

participant "Web UI" as web_ui

box Backend
    control "Service Manager" as service_manager
    participant "Deliverability Test Service" as deliverability_test
end box

box Database
    database "deliverability_test" as dt
    database "deliverability_test_logs" as dtl
end box

/' Step-by-step deletion flow with cascade '/

user -> web_ui: Clicks "Delete Test" {test_id}
web_ui -> service_manager: Request delete for {test_id}
service_manager -> deliverability_test: Delete test {test_id}
activate deliverability_test

deliverability_test -> dt: DELETE test WHERE test_id = {test_id}
activate dt
dt -> dt: Locate row in deliverability_test with test_id
dt -> dt: Remove test row from deliverability_test

/' Cascade process begins '/
dt -> dtl: Trigger ON DELETE CASCADE for test_id
activate dtl
dtl -> dtl: Find all logs WHERE test_id = {test_id}
dtl -> dtl: DELETE logs with test_id = {test_id}
dtl --> dt: Logs deleted
deactivate dtl

dt --> deliverability_test: Test and logs deleted
deactivate dt

deliverability_test --> service_manager: Deletion successful
service_manager --> web_ui: Success response
web_ui --> user: Removed test from display

@enduml
