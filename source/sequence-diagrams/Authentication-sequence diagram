@startuml
!pragma teoz true
actor User

participant "Web UI" as WebUI
box Backend
box Service Manager
participant "External API" as ext
control "Service Manager" as ServiceManager
participant "Service API" as api
end box
participant "Deliverability Test" as DeliverabilityTest
participant "Deliverability Test Log" as DeliverabilityTestLog
participant "Messaging Service" as MessagingService
participant "Deliverability Test Phones" as DeliverabilityTestPhones
participant "Report Generation Service" as ReportService
participant "Authentication Service" as AuthService
end box
box Database
database "deliverability_test" as DBTest
database "deliverability_test_logs" as DBLogs
database "deliverability_test_phones" as DBPhones
database deliverability_test_users as dtu
end box
box Aggregator API
participant "Bandwidth API" as Bandwidth
end box

== Log in ==

    User -> WebUI : Login with (user_details)
    WebUI -> ext : Login with (user_details)
activate AuthService
ext -> ServiceManager : Authenticate user details
ServiceManager -> AuthService : Authenticate user with (user_details)
AuthService -> dtu : Get user with (user_details)
dtu --> AuthService : (user_details_entity)
AuthService -> AuthService : Check User details

alt User exists
    alt User details are correct
        AuthService --> api: User has valid details
        api->ServiceManager: User has valid details
        ServiceManager --> WebUI: Logged in
    else User details are incorrect
        AuthService --> api : User has invalid details
        api->ServiceManager:User has invalid details
        ServiceManager -> User : Please enter the correct details
    end
else User does not exist
    AuthService --> api : User does not exist
    api->ServiceManager:User does not exist
    deactivate AuthService
    ServiceManager -> User : No User found
end

@enduml
