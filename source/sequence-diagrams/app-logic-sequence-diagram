@startuml
!pragma teoz true
title Read Incoming SMS Messages 

actor User
box Front end
participant "Flutter Mobile App" as Flutter
participant "Native Android/iOS Layer\n(readsms Plugin)" as Native
participant "UI Renderer" as UI
end box
box Backend
box Service Manager
participant "External API" as ext
control "Service Manager" as sm
participant "Service API" as api
end box
participant "Deliverability Test Logs" as dtl
database deliverability_test_logs as db
end box

User -> Flutter : Launch App
Flutter -> Native : Initialize SMS Listener (readsms)
Native --> Flutter : Wait for incoming SMS...

== New SMS Received ==

Native -> Flutter : onSmsReceived Event Triggered
== Display on App ==
Flutter -> Flutter : Parse SMS Content
Flutter -> UI : Update UI with Message
UI -> User : Display message content 
== Update Logs ==
Flutter-> ext :Message Recieved
ext->sm:Message Recieved
sm-> dtl: Update test {test_log_id} to received.
            activate dtl
            dtl -> db: Update test with {test_log_id} to received.
            dtl --> sm: Test updated.
            deactivate dtl
@enduml
